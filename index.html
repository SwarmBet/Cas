<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWARMBET | ELITE ONLINE CASINO</title>
    <style>
        :root {
            --gold: #d4af37;
            --gold-bright: #f9e295;
            --dark-bg: #050505;
            --panel-bg: #0f0f0f;
            --green: #27ae60;
            --red: #c0392b;
            --blue: #2980b9;
            --text: #e0e0e0;
            --border: #222;
            --shadow: 0 8px 32px rgba(0,0,0,0.8);
            --font: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        body {
            background-color: var(--dark-bg);
            color: var(--text);
            font-family: var(--font);
            overflow-x: hidden;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
        }

        /* --- UI UTILITIES --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .center { align-items: center; justify-content: center; }
        .gold-glow { text-shadow: 0 0 10px rgba(212, 175, 55, 0.6); color: var(--gold); }
        .btn {
            background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
            border: 1px solid var(--border);
            color: white;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { border-color: var(--gold); box-shadow: 0 0 15px var(--gold); transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        .btn-gold { background: linear-gradient(145deg, var(--gold), #8a6d3b); color: black; border: none; }
        .btn-gold:hover { background: var(--gold-bright); box-shadow: 0 0 20px var(--gold-bright); }

        /* --- NAVIGATION --- */
        nav {
            background: rgba(0,0,0,0.95);
            border-bottom: 2px solid var(--gold);
            padding: 0 40px;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .logo { font-size: 28px; font-weight: 900; letter-spacing: 3px; cursor: pointer; text-transform: uppercase; }
        .logo span { color: var(--gold); }
        .nav-links { display: flex; gap: 30px; }
        .nav-links div { cursor: pointer; font-weight: 600; transition: 0.3s; color: #888; text-transform: uppercase; font-size: 14px; }
        .nav-links div:hover, .nav-links div.active { color: var(--gold); }
        .user-nav { display: flex; align-items: center; gap: 20px; }
        .balance-box { 
            background: #1a1a1a; 
            padding: 8px 15px; 
            border-radius: 4px; 
            border: 1px solid var(--gold); 
            font-weight: bold; 
            box-shadow: inset 0 0 10px rgba(212, 175, 55, 0.2);
            color: var(--gold-bright);
        }

        /* --- AUTH --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 2000; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }
        .auth-card {
            background: var(--panel-bg); border: 1px solid var(--gold);
            padding: 50px; width: 450px; border-radius: 8px; box-shadow: var(--shadow);
            text-align: center; position: relative;
        }
        .auth-card h1 { margin-bottom: 30px; }
        .auth-card input {
            width: 100%; padding: 15px; margin: 10px 0;
            background: #000; border: 1px solid #333; color: white; border-radius: 4px;
            font-size: 16px;
        }
        .auth-card input:focus { border-color: var(--gold); }

        /* --- MAIN LAYOUT --- */
        .app-container { max-width: 1600px; margin: 20px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .main-view { min-height: 85vh; }
        .panel { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 8px; padding: 25px; box-shadow: var(--shadow); position: relative; overflow: hidden; }
        .panel-header { font-size: 18px; font-weight: bold; margin-bottom: 20px; border-bottom: 1px solid #222; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; color: var(--gold); }

        /* --- GAME TILES --- */
        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .game-card {
            height: 250px; border-radius: 12px; background: #1a1a1a; cursor: pointer;
            position: relative; overflow: hidden; border: 1px solid #333; transition: 0.4s;
            display: flex; flex-direction: column; justify-content: flex-end; padding: 30px;
            background-size: cover; background-position: center;
        }
        .game-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 20%, transparent 100%); z-index: 1;
        }
        .game-card:hover { transform: scale(1.02); border-color: var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.8), 0 0 15px rgba(212, 175, 55, 0.3); }
        .game-card h3 { position: relative; z-index: 2; margin: 0; font-size: 26px; color: white; }
        .game-card p { position: relative; z-index: 2; margin: 5px 0 0; color: var(--gold); font-size: 14px; font-weight: bold; }

        /* --- ROULETTE TABLE --- */
        .roulette-container { display: flex; flex-direction: column; align-items: center; gap: 30px; }
        .wheel-view { width: 100%; height: 140px; background: #000; border: 2px solid var(--gold); overflow: hidden; position: relative; border-radius: 8px; box-shadow: inset 0 0 30px rgba(212, 175, 55, 0.2); }
        .wheel-strip { display: flex; position: absolute; left: 50%; height: 100%; transition: transform 7s cubic-bezier(0.1, 0, 0.1, 1); }
        .wheel-slot { min-width: 90px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 900; border-right: 1px solid rgba(255,255,255,0.05); text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .wheel-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: var(--gold-bright); transform: translateX(-50%); z-index: 10; box-shadow: 0 0 20px var(--gold); }
        
        .bet-table { display: grid; grid-template-columns: 70px repeat(12, 1fr); gap: 3px; background: #222; padding: 8px; border-radius: 6px; user-select: none; width: 100%; max-width: 1000px; }
        .bet-cell { height: 70px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; font-weight: bold; font-size: 20px; transition: 0.1s; background: #1a1a1a; border-radius: 4px; }
        .bet-cell:hover { filter: brightness(1.4); transform: scale(0.98); }
        .n-zero { grid-row: span 3; background: var(--green); }
        .n-red { background: var(--red); color: white; }
        .n-black { background: #111; color: white; }
        .outside-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; width: 100%; max-width: 1000px; margin-top: 3px; }
        .outside-cell { height: 60px; background: #2c3e50; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border-radius: 4px; font-size: 14px; text-transform: uppercase; }
        .outside-cell:hover { background: #34495e; }

        .chip-display { 
            position: absolute; width: 34px; height: 34px; border-radius: 50%; background: radial-gradient(circle, #fff 0%, var(--gold) 100%); 
            color: black; font-size: 11px; display: flex; align-items: center; justify-content: center; 
            border: 2px dashed #000; font-weight: 900; pointer-events: none; z-index: 5;
            box-shadow: 0 3px 6px rgba(0,0,0,0.6); animation: chipPop 0.2s ease-out;
        }
        @keyframes chipPop { from { transform: scale(1.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- COINFLIP --- */
        .coin-box { perspective: 1000px; width: 200px; height: 200px; margin: 40px auto; }
        .coin-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 3s cubic-bezier(0.2, 0, 0.2, 1); }
        .coin-face { position: absolute; width: 100%; height: 100%; border-radius: 50%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 900; border: 10px solid var(--gold); box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); }
        .coin-heads { background: radial-gradient(circle, #f1c40f, #d4af37); color: #000; }
        .coin-tails { background: radial-gradient(circle, #95a5a6, #7f8c8d); color: #000; transform: rotateY(180deg); }

        /* --- DICE --- */
        .dice-wrap { display: flex; gap: 30px; justify-content: center; margin: 50px 0; }
        .die-body { width: 100px; height: 100px; background: white; border-radius: 15px; color: black; display: flex; align-items: center; justify-content: center; font-size: 50px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); font-weight: bold; position: relative; }

        /* --- BACCARAT --- */
        .baccarat-arena { display: flex; justify-content: space-around; margin-top: 30px; }
        .baccarat-side { text-align: center; width: 45%; background: rgba(255,255,255,0.03); padding: 25px; border-radius: 12px; border: 1px solid #333; }
        .card-container { display: flex; gap: 12px; justify-content: center; margin: 20px 0; height: 140px; }
        .casino-card { 
            width: 90px; height: 130px; background: white; border-radius: 8px; color: black; 
            display: flex; flex-direction: column; padding: 8px; font-weight: bold; position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 20px; animation: cardSlide 0.5s ease-out;
        }
        @keyframes cardSlide { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- SIDEBAR CHAT & STATS --- */
        .chat-area { height: 400px; display: flex; flex-direction: column; }
        .chat-msgs { flex: 1; overflow-y: auto; padding-right: 10px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .msg-bubble { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; font-size: 13px; line-height: 1.5; border-left: 3px solid #444; }
        .msg-user { color: var(--gold); font-weight: bold; margin-bottom: 3px; display: flex; justify-content: space-between; }
        .msg-time { color: #555; font-size: 10px; }
        .chat-input-row { display: flex; gap: 10px; }
        .chat-input-row input { flex: 1; background: #000; border: 1px solid #333; color: white; padding: 10px; border-radius: 4px; }

        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .leaderboard-table tr { border-bottom: 1px solid #1a1a1a; }
        .leaderboard-table td { padding: 12px 5px; font-size: 14px; }
        .row-gold { color: var(--gold); font-weight: bold; background: rgba(212, 175, 55, 0.05); }

        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #1a1a1a; font-size: 13px; }
        .hist-win { color: var(--green); font-weight: bold; }
        .hist-loss { color: var(--red); }

        /* --- FOOTER --- */
        footer { margin-top: 60px; padding: 50px 40px; background: #080808; border-top: 1px solid #1a1a1a; text-align: center; color: #444; }
        .footer-logo { font-size: 22px; color: #222; margin-bottom: 20px; font-weight: 900; }

        /* --- OVERLAYS & MODALS --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; center; justify-content: center; align-items: center; }
        .bonus-animation { text-align: center; }
        .bonus-animation h2 { font-size: 60px; margin-bottom: 20px; }

        .admin-btn { position: fixed; bottom: 10px; left: 10px; opacity: 0.1; cursor: pointer; color: white; z-index: 5000; font-size: 10px; }
        .admin-panel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222; border: 2px solid var(--gold); padding: 30px; z-index: 5001; width: 400px; box-shadow: 0 0 100px rgba(0,0,0,1); }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .view-fade { animation: fadeIn 0.4s ease-in-out; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 class="logo">SWARM<span>BET</span></h1>
            <p style="color: #666; margin-bottom: 20px;">Premium Multi-User Experience</p>
            <div id="auth-error" style="color: var(--red); font-size: 14px; margin-bottom: 10px; height: 18px;"></div>
            <input type="text" id="auth-username" placeholder="Username (min 3 chars)" maxlength="15">
            <input type="password" id="auth-password" placeholder="Password (min 5 chars)">
            <div class="flex" style="gap: 15px; margin-top: 20px;">
                <button class="btn btn-gold" style="flex: 1;" onclick="app.auth('login')">Login</button>
                <button class="btn" style="flex: 1;" onclick="app.auth('register')">Register</button>
            </div>
        </div>
        <p style="margin-top: 40px; color: #333; font-size: 12px;">PROVABLY FAIR | 18+ | © 2026 SWARMBET NETWORK</p>
    </div>

    <nav id="main-nav" class="hidden">
        <div class="logo" onclick="app.navigate('home')">SWARM<span>BET</span></div>
        <div class="nav-links">
            <div id="nav-home" class="active" onclick="app.navigate('home')">Home</div>
            <div id="nav-games" onclick="app.navigate('games')">Games</div>
            <div id="nav-discord" onclick="app.navigate('discord')">Discord</div>
        </div>
        <div class="user-nav">
            <div class="balance-box">⭐ <span id="display-balance">0.00</span></div>
            <div id="display-username" class="gold-glow" style="font-weight: 800; cursor: pointer;">PLAYER</div>
            <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="app.logout()">Logout</button>
        </div>
    </nav>

    <div id="app-content" class="app-container hidden">
        
        <div class="main-view">
            
            <div id="view-home" class="view-fade">
                <div class="panel" style="background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%); border-left: 5px solid var(--gold); margin-bottom: 30px;">
                    <h2 style="font-size: 32px; margin-bottom: 10px;">WELCOME BACK, <span id="welcome-user" class="gold-glow">...</span>!</h2>
                    <p style="color: #888; max-width: 600px;">The most advanced provably fair gaming platform is at your fingertips. Claim your daily bonus and start your journey to the top of the leaderboard.</p>
                    <div class="flex" style="gap: 20px; margin-top: 25px;">
                        <button id="daily-bonus-btn" class="btn btn-gold" onclick="app.claimDaily()">Claim Daily Bonus</button>
                        <button class="btn" onclick="app.navigate('games')">Browse Games</button>
                    </div>
                </div>

                <div class="game-grid">
                    <div class="game-card" style="background-image: url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?auto=format&fit=crop&q=80&w=600')" onclick="app.play('roulette')">
                        <h3>ROULETTE</h3>
                        <p>European • Multi-Bet • High Stakes</p>
                    </div>
                    <div class="game-card" style="background-image: url('https://images.unsplash.com/photo-1605870445919-838d190e8e1b?auto=format&fit=crop&q=80&w=600')" onclick="app.play('coinflip')">
                        <h3>COINFLIP</h3>
                        <p>Instant 50/50 • Double your money</p>
                    </div>
                    <div class="game-card" style="background-image: url('https://images.unsplash.com/photo-1518133835878-5a93cc3f89e5?auto=format&fit=crop&q=80&w=600')" onclick="app.play('dice')">
                        <h3>DICE</h3>
                        <p>Classic Roll • Custom Odds</p>
                    </div>
                    <div class="game-card" style="background-image: url('https://images.unsplash.com/photo-1534423839368-17a15c44139a?auto=format&fit=crop&q=80&w=600')" onclick="app.play('baccarat')">
                        <h3>BACCARAT</h3>
                        <p>Elite Professional Cards</p>
                    </div>
                </div>
            </div>

            <div id="view-games" class="hidden view-fade">
                <div class="panel-header">AVAILABLE GAMES <span>4 ACTIVE</span></div>
                <div class="game-grid">
                    <div class="game-card" onclick="app.play('roulette')"><h3>ROULETTE</h3><p>Classic Table</p></div>
                    <div class="game-card" onclick="app.play('coinflip')"><h3>COINFLIP</h3><p>50/50 Luck</p></div>
                    <div class="game-card" onclick="app.play('dice')"><h3>DICE</h3><p>Predict Number</p></div>
                    <div class="game-card" onclick="app.play('baccarat')"><h3>BACCARAT</h3><p>Dealer Game</p></div>
                </div>
            </div>

            <div id="view-discord" class="hidden view-fade">
                <div class="panel" style="text-align: center; padding: 80px 40px;">
                    <h1 class="gold-glow" style="font-size: 50px; margin-bottom: 20px;">JOIN OUR DISCORD</h1>
                    <p style="font-size: 18px; color: #aaa; margin-bottom: 40px;">Get exclusive codes, participate in giveaways and talk with other whales.</p>
                    <button class="btn btn-gold" style="font-size: 20px;" onclick="window.open('https://discord.com', '_blank')">Connect with Discord</button>
                </div>
            </div>

            <div id="view-play" class="hidden view-fade">
                <div id="game-dynamic-content"></div>
                
                <div class="panel" style="margin-top: 20px;">
                    <div class="panel-header">GAME HISTORY <span id="game-hist-title">...</span></div>
                    <div id="game-history-list" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>

        </div>

        <div class="sidebar-view">
            
            <div class="panel" style="margin-bottom: 20px;">
                <div class="panel-header">GLOBAL CHAT <span id="online-count" style="color: var(--green); font-size: 12px;">● 0 Online</span></div>
                <div class="chat-area">
                    <div id="chat-msgs" class="chat-msgs"></div>
                    <div class="chat-input-row">
                        <input type="text" id="chat-input" placeholder="Type a message..." maxlength="100">
                        <button class="btn btn-gold" onclick="app.sendChat()">></button>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-bottom: 20px;">
                <div class="panel-header">TOP WHALES</div>
                <table class="leaderboard-table" id="leaderboard-body"></table>
            </div>

            <div class="panel">
                <div class="panel-header">SETTINGS</div>
                <div style="font-size: 14px;">
                    <div class="flex" style="justify-content: space-between; margin-bottom: 15px;">
                        <span>Sound Effects</span>
                        <input type="checkbox" id="set-sounds" checked onchange="app.saveSettings()">
                    </div>
                    <div class="flex" style="justify-content: space-between; margin-bottom: 15px;">
                        <span>Animations</span>
                        <input type="checkbox" id="set-anims" checked onchange="app.saveSettings()">
                    </div>
                    <div class="flex" style="justify-content: space-between; font-size: 11px; color: #555;">
                        <span>Server Location</span>
                        <span>Europe-West1</span>
                    </div>
                </div>
            </div>

            <div id="online-list-panel" style="margin-top: 15px; font-size: 11px; color: #444; padding: 0 10px;">
                <b>Online:</b> <span id="online-users-names"></span>
            </div>
        </div>

    </div>

    <div id="bonus-modal" class="modal-overlay hidden">
        <div class="bonus-animation">
            <h3 class="gold-glow">CONGRATULATIONS!</h3>
            <h2 id="bonus-amount-text" class="gold-glow">⭐ 500</h2>
            <p>DAILY REWARD ADDED TO YOUR BALANCE</p>
            <button class="btn btn-gold" style="margin-top: 30px;" onclick="document.getElementById('bonus-modal').classList.add('hidden')">AWESOME</button>
        </div>
    </div>

    <div id="admin-trigger" class="admin-btn" onclick="app.showAdmin()">[ADMIN]</div>
    <div id="admin-modal" class="admin-panel hidden">
        <h3 class="gold-glow">ADMIN DEBUG</h3>
        <hr style="margin: 15px 0; border: #333 1px solid;">
        <label>Add Balance to Self:</label>
        <input type="number" id="admin-chips" value="1000" style="width: 100%; background: #000; color: #fff; padding: 10px; margin: 10px 0; border: 1px solid var(--gold);">
        <button class="btn btn-gold" style="width: 100%;" onclick="app.adminAddChips()">ADD CHIPS</button>
        <button class="btn" style="width: 100%; margin-top: 10px;" onclick="document.getElementById('admin-modal').classList.add('hidden')">CLOSE</button>
    </div>

    <footer>
        <div class="footer-logo">SWARM<span>BET</span></div>
        <div style="margin-bottom: 20px; font-size: 14px; color: #666;">
            SWARMBET is the world's leading decentralized gaming platform. 
            All results are generated using a cryptographically secure RNG.
        </div>
        <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; color: var(--gold); font-size: 12px; font-weight: bold;">
            <div>RESPONSIBLE GAMING</div>
            <div>TERMS OF SERVICE</div>
            <div>PRIVACY POLICY</div>
            <div>PROVABLY FAIR</div>
        </div>
        <div style="color: #222; font-size: 11px;">© 2026 SWARMBET NETWORK OPERATIONS. LICENSED UNDER SG-2026. ALL RIGHTS RESERVED.</div>
    </footer>

    <script>
        /* ================================================================
        SWARMBET CASINO - CORE ENGINE 2026
        ================================================================
        */

        const DB_URL = "https://casbss-c75a0-default-rtdb.europe-west1.firebasedatabase.app/";

        const app = {
            user: null,
            balance: 0,
            activeView: 'home',
            activeGame: null,
            sounds: true,
            anims: true,
            isGaming: false,
            chatCooldown: false,
            syncInterval: null,
            rouletteBets: [],
            
            // --- CORE SYSTEM ---
            async init() {
                this.loadSettings();
                const session = localStorage.getItem('swarm_session');
                if (session) {
                    const data = await this.api(`users/${session}`);
                    if (data) {
                        this.loginSuccess(data);
                    } else {
                        localStorage.removeItem('swarm_session');
                    }
                }
            },

            async api(path, method = 'GET', body = null) {
                try {
                    const options = { method, headers: { 'Content-Type': 'application/json' } };
                    if (body) options.body = JSON.stringify(body);
                    const response = await fetch(`${DB_URL}${path}.json`, options);
                    if (!response.ok) throw new Error("Network error");
                    return await response.json();
                } catch (e) {
                    console.error("Firebase Error:", e);
                    return null;
                }
            },

            // --- AUTHENTICATION ---
            async auth(type) {
                const u = document.getElementById('auth-username').value.trim().toLowerCase();
                const p = document.getElementById('auth-password').value;
                const err = document.getElementById('auth-error');

                if (u.length < 3) return err.innerText = "Username too short";
                if (p.length < 5) return err.innerText = "Password too short";

                const existing = await this.api(`users/${u}`);

                if (type === 'register') {
                    if (existing) return err.innerText = "Username already taken";
                    const newUser = {
                        username: u,
                        password: p,
                        balance: 500,
                        lastDaily: 0,
                        joined: Date.now(),
                        online: true
                    };
                    await this.api(`users/${u}`, 'PUT', newUser);
                    this.loginSuccess(newUser);
                } else {
                    if (!existing || existing.password !== p) return err.innerText = "Invalid credentials";
                    await this.api(`users/${u}/online`, 'PUT', true);
                    this.loginSuccess(existing);
                }
            },

            loginSuccess(userData) {
                this.user = userData.username;
                this.balance = userData.balance;
                localStorage.setItem('swarm_session', this.user);
                
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                
                document.getElementById('display-username').innerText = this.user.toUpperCase();
                document.getElementById('welcome-user').innerText = this.user.toUpperCase();
                this.updateUI();
                this.startSync();
                this.navigate('home');
                this.checkDailyStatus();
            },

            logout() {
                if (this.user) this.api(`users/${this.user}/online`, 'PUT', false);
                localStorage.removeItem('swarm_session');
                location.reload();
            },

            // --- UI & NAVIGATION ---
            navigate(view) {
                if (this.isGaming) return;
                this.activeView = view;
                
                ['home', 'games', 'discord', 'play'].forEach(v => {
                    document.getElementById(`view-${v}`).classList.add('hidden');
                    const navLink = document.getElementById(`nav-${v}`);
                    if (navLink) navLink.classList.remove('active');
                });

                document.getElementById(`view-${view}`).classList.remove('hidden');
                const activeLink = document.getElementById(`nav-${view}`);
                if (activeLink) activeLink.classList.add('active');
                
                if (view !== 'play') this.activeGame = null;
            },

            updateUI() {
                document.getElementById('display-balance').innerText = this.balance.toLocaleString(undefined, {minimumFractionDigits: 2});
            },

            loadSettings() {
                const s = JSON.parse(localStorage.getItem('swarm_settings') || '{"sounds":true,"anims":true}');
                this.sounds = s.sounds;
                this.anims = s.anims;
                document.getElementById('set-sounds').checked = this.sounds;
                document.getElementById('set-anims').checked = this.anims;
            },

            saveSettings() {
                this.sounds = document.getElementById('set-sounds').checked;
                this.anims = document.getElementById('set-anims').checked;
                localStorage.setItem('swarm_settings', JSON.stringify({sounds: this.sounds, anims: this.anims}));
            },

            playSound(type) {
                if (!this.sounds) return;
                const audios = {
                    'win': 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3',
                    'loss': 'https://www.soundjay.com/buttons/button-10.mp3',
                    'click': 'https://www.soundjay.com/buttons/button-16.mp3',
                    'spin': 'https://www.soundjay.com/mechanic/sounds/mechanical-clutter-1.mp3',
                    'chip': 'https://www.soundjay.com/buttons/button-50.mp3'
                };
                const a = new Audio(audios[type]);
                a.volume = 0.4;
                a.play().catch(() => {});
            },

            // --- DATABASE SYNC ---
            startSync() {
                this.syncInterval = setInterval(async () => {
                    // Sync online status & balance
                    const userData = await this.api(`users/${this.user}`);
                    if (userData && !this.isGaming) {
                        this.balance = userData.balance;
                        this.updateUI();
                    }

                    // Leaderboard & Global Info
                    const allUsers = await this.api('users');
                    if (allUsers) {
                        const sorted = Object.values(allUsers).sort((a,b) => b.balance - a.balance).slice(0, 10);
                        const lbBody = document.getElementById('leaderboard-body');
                        lbBody.innerHTML = sorted.map((u, i) => `
                            <tr class="${i === 0 ? 'row-gold' : ''}">
                                <td style="width: 30px">#${i+1}</td>
                                <td>${u.username}</td>
                                <td style="text-align: right">⭐ ${Math.floor(u.balance).toLocaleString()}</td>
                            </tr>
                        `).join('');

                        const online = Object.values(allUsers).filter(u => u.online);
                        document.getElementById('online-count').innerText = `● ${online.length} Online`;
                        document.getElementById('online-users-names').innerText = online.map(u => u.username).join(', ');
                    }

                    // Chat sync
                    const chat = await this.api('chat');
                    if (chat) {
                        const msgs = Object.values(chat).slice(-20);
                        const chatBox = document.getElementById('chat-msgs');
                        chatBox.innerHTML = msgs.map(m => `
                            <div class="msg-bubble">
                                <div class="msg-user">
                                    <span>${m.user}</span>
                                    <span class="msg-time">${new Date(m.time).toLocaleTimeString()}</span>
                                </div>
                                <div class="msg-text">${this.escapeHTML(m.text)}</div>
                            </div>
                        `).join('');
                        chatBox.scrollTop = chatBox.scrollHeight;
                    }
                }, 4000);

                // Set online on load
                this.api(`users/${this.user}/online`, 'PUT', true);
                window.addEventListener('beforeunload', () => {
                    this.api(`users/${this.user}/online`, 'PUT', false);
                });
            },

            async sendChat() {
                if (this.chatCooldown) return;
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;

                this.chatCooldown = true;
                await this.api(`chat/${Date.now()}`, 'PUT', {
                    user: this.user,
                    text: text,
                    time: Date.now()
                });
                input.value = "";
                setTimeout(() => this.chatCooldown = false, 2000);
            },

            escapeHTML(str) {
                return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
            },

            // --- BONUS SYSTEM ---
            async checkDailyStatus() {
                const last = await this.api(`users/${this.user}/lastDaily`);
                const btn = document.getElementById('daily-bonus-btn');
                const now = Date.now();
                if (now - last > 86400000) {
                    btn.classList.add('btn-gold');
                    btn.innerText = "Claim Daily Bonus";
                    btn.disabled = false;
                } else {
                    btn.classList.remove('btn-gold');
                    const remaining = 86400000 - (now - last);
                    const hours = Math.floor(remaining / 3600000);
                    btn.innerText = `Bonus in ${hours}h`;
                    btn.disabled = true;
                }
            },

            async claimDaily() {
                const amount = Math.floor(Math.random() * 451) + 50;
                this.balance += amount;
                await this.api(`users/${this.user}/balance`, 'PUT', this.balance);
                await this.api(`users/${this.user}/lastDaily`, 'PUT', Date.now());
                
                document.getElementById('bonus-amount-text').innerText = `⭐ ${amount}`;
                document.getElementById('bonus-modal').classList.remove('hidden');
                this.updateUI();
                this.checkDailyStatus();
                this.logGame('BONUS', 'Daily Reward', amount, 'WIN');
            },

            // --- SECURITY & LOGGING ---
            async updateBalance(netChange) {
                if (this.balance + netChange < 0) return false;
                this.balance += netChange;
                this.updateUI();
                await this.api(`users/${this.user}/balance`, 'PUT', this.balance);
                return true;
            },

            async logGame(game, type, amount, result) {
                const entry = {
                    game, type, amount, result, time: Date.now()
                };
                await this.api(`history/${this.user}/${Date.now()}`, 'PUT', entry);
                await this.api(`global_history/${Date.now()}`, 'PUT', { ...entry, user: this.user });
                this.loadGameHistory(game);
            },

            async loadGameHistory(game) {
                const hist = await this.api(`history/${this.user}`);
                if (!hist) return;
                const list = document.getElementById('game-history-list');
                const filtered = Object.values(hist).filter(h => h.game === game).reverse().slice(0, 20);
                list.innerHTML = filtered.map(h => `
                    <div class="history-item">
                        <span>${h.type}</span>
                        <span class="${h.result === 'WIN' ? 'hist-win' : 'hist-loss'}">${h.result === 'WIN' ? '+' : ''}${h.amount} ⭐</span>
                        <span style="color: #444">${new Date(h.time).toLocaleTimeString()}</span>
                    </div>
                `).join('');
            },

            // --- GAMES LOGIC ---
            play(game) {
                this.activeGame = game;
                this.navigate('play');
                document.getElementById('game-hist-title').innerText = game.toUpperCase();
                this.renderGame(game);
                this.loadGameHistory(game.toUpperCase());
            },

            renderGame(game) {
                const container = document.getElementById('game-dynamic-content');
                let html = "";

                if (game === 'roulette') {
                    this.rouletteBets = [];
                    html = `
                        <div class="panel roulette-container">
                            <div class="wheel-view">
                                <div class="wheel-marker"></div>
                                <div id="r-wheel" class="wheel-strip"></div>
                            </div>
                            
                            <div class="bet-table" id="r-table-main"></div>
                            
                            <div class="outside-grid">
                                <div class="outside-cell" onclick="app.addRBet('1-18', 50)">1 to 18</div>
                                <div class="outside-cell" onclick="app.addRBet('even', 50)">Even</div>
                                <div class="outside-cell" style="background: var(--red)" onclick="app.addRBet('red', 50)">Red</div>
                                <div class="outside-cell" style="background: #111" onclick="app.addRBet('black', 50)">Black</div>
                                <div class="outside-cell" onclick="app.addRBet('odd', 50)">Odd</div>
                                <div class="outside-cell" onclick="app.addRBet('19-36', 50)">19 to 36</div>
                            </div>

                            <div class="flex center" style="gap: 20px; width: 100%; margin-top: 20px;">
                                <div class="balance-box" style="font-size: 20px;">TOTAL BET: <span id="r-total-bet">0</span></div>
                                <button id="r-spin-btn" class="btn btn-gold" style="padding: 15px 40px;" onclick="app.spinRoulette()">SPIN WHEEL</button>
                                <button class="btn" onclick="app.clearRoulette()">Clear</button>
                            </div>
                        </div>
                    `;
                } else if (game === 'coinflip') {
                    html = `
                        <div class="panel" style="text-align: center;">
                            <h2 class="gold-glow">COINFLIP</h2>
                            <div class="coin-box">
                                <div id="coin-inner" class="coin-inner">
                                    <div class="coin-face coin-heads">HEADS</div>
                                    <div class="coin-face coin-tails">TAILS</div>
                                </div>
                            </div>
                            <div class="flex center" style="gap: 20px; margin-bottom: 30px;">
                                <button id="cf-h" class="btn btn-gold" onclick="app.cfSide='heads'; app.updateCFUI()">HEADS</button>
                                <button id="cf-t" class="btn" onclick="app.cfSide='tails'; app.updateCFUI()">TAILS</button>
                            </div>
                            <div class="flex center" style="gap: 15px;">
                                <input type="number" id="cf-bet" value="50" style="background: #000; color: white; border: 1px solid #333; padding: 15px; width: 150px; text-align: center; font-size: 20px;">
                                <button id="cf-play" class="btn btn-gold" onclick="app.playCoinflip()">Flip Coin</button>
                            </div>
                        </div>
                    `;
                    this.cfSide = 'heads';
                } else if (game === 'dice') {
                    html = `
                        <div class="panel" style="text-align: center;">
                            <h2 class="gold-glow">DICE ROLL</h2>
                            <div class="dice-wrap">
                                <div id="die-val" class="die-body">1</div>
                            </div>
                            <div class="flex center" style="gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
                                <button class="btn" onclick="app.playDice('low')">Low (1-3)</button>
                                <button class="btn" onclick="app.playDice('high')">High (4-6)</button>
                                <button class="btn" onclick="app.playDice('even')">Even</button>
                                <button class="btn" onclick="app.playDice('odd')">Odd</button>
                                <input type="number" id="dice-target" placeholder="Specific (1-6)" style="background: #000; color: white; border: 1px solid #333; padding: 12px; width: 140px;">
                                <button class="btn btn-gold" onclick="app.playDice('target')">Target Number</button>
                            </div>
                            <input type="number" id="dice-bet" value="50" style="background: #000; color: white; border: 1px solid #333; padding: 15px; width: 200px; text-align: center; font-size: 20px;">
                        </div>
                    `;
                } else if (game === 'baccarat') {
                    html = `
                        <div class="panel" style="text-align: center;">
                            <h2 class="gold-glow">BACCARAT PRO</h2>
                            <div class="baccarat-arena">
                                <div class="baccarat-side">
                                    <h3 style="color: var(--blue)">PLAYER</h3>
                                    <div id="bac-p-score" style="font-size: 24px; margin: 10px 0;">0</div>
                                    <div id="bac-p-cards" class="card-container"></div>
                                </div>
                                <div class="baccarat-side">
                                    <h3 style="color: var(--red)">BANKER</h3>
                                    <div id="bac-b-score" style="font-size: 24px; margin: 10px 0;">0</div>
                                    <div id="bac-b-cards" class="card-container"></div>
                                </div>
                            </div>
                            <div class="flex center" style="gap: 15px; margin: 30px 0;">
                                <button class="btn" style="border-color: var(--blue)" onclick="app.playBaccarat('player')">PLAYER (2x)</button>
                                <button class="btn" style="border-color: var(--gold)" onclick="app.playBaccarat('tie')">TIE (9x)</button>
                                <button class="btn" style="border-color: var(--red)" onclick="app.playBaccarat('banker')">BANKER (1.95x)</button>
                            </div>
                            <input type="number" id="bac-bet" value="100" style="background: #000; color: white; border: 1px solid #333; padding: 15px; width: 200px; text-align: center; font-size: 20px;">
                        </div>
                    `;
                }

                container.innerHTML = html;
                if (game === 'roulette') this.initRoulette();
            },

            // --- ROULETTE LOGIC ---
            rNumbers: [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26],
            rReds: [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36],

            initRoulette() {
                const table = document.getElementById('r-table-main');
                table.innerHTML = "";
                
                // Zero
                const zero = document.createElement('div');
                zero.className = "bet-cell n-zero";
                zero.id = "r-cell-0";
                zero.innerText = "0";
                zero.onclick = () => this.addRBet('0', 50);
                table.appendChild(zero);

                // Grid 1-36
                for(let i=1; i<=36; i++) {
                    const cell = document.createElement('div');
                    const isRed = this.rReds.includes(i);
                    cell.className = `bet-cell ${isRed ? 'n-red' : 'n-black'}`;
                    cell.id = `r-cell-${i}`;
                    cell.innerText = i;
                    cell.onclick = () => this.addRBet(i.toString(), 50);
                    table.appendChild(cell);
                }

                // Wheel Strip
                const strip = document.getElementById('r-wheel');
                let stripHTML = "";
                for(let j=0; j<5; j++) {
                    this.rNumbers.forEach(n => {
                        const color = n === 0 ? 'var(--green)' : (this.rReds.includes(n) ? 'var(--red)' : '#111');
                        stripHTML += `<div class="wheel-slot" style="background: ${color}">${n}</div>`;
                    });
                }
                strip.innerHTML = stripHTML;
            },

            addRBet(type, amount) {
                if (this.isGaming) return;
                if (this.balance < amount) return;
                
                this.playSound('chip');
                this.balance -= amount;
                this.updateUI();
                
                const existing = this.rouletteBets.find(b => b.type === type);
                if (existing) {
                    existing.amount += amount;
                } else {
                    this.rouletteBets.push({ type, amount });
                }
                this.drawChips();
            },

            drawChips() {
                document.querySelectorAll('.chip-display').forEach(c => c.remove());
                let total = 0;
                this.rouletteBets.forEach(bet => {
                    total += bet.amount;
                    const cell = document.getElementById(`r-cell-${bet.type}`);
                    if (cell) {
                        const chip = document.createElement('div');
                        chip.className = "chip-display";
                        chip.innerText = bet.amount;
                        cell.appendChild(chip);
                    }
                });
                document.getElementById('r-total-bet').innerText = total;
            },

            clearRoulette() {
                if (this.isGaming) return;
                this.rouletteBets.forEach(b => this.balance += b.amount);
                this.rouletteBets = [];
                this.updateUI();
                this.drawChips();
            },

            async spinRoulette() {
                if (this.isGaming || this.rouletteBets.length === 0) return;
                this.isGaming = true;
                const spinBtn = document.getElementById('r-spin-btn');
                spinBtn.disabled = true;
                this.playSound('spin');

                const winNum = this.rNumbers[Math.floor(Math.random() * 37)];
                const wheel = document.getElementById('r-wheel');
                
                const slotWidth = 90;
                const fullCycle = 37 * slotWidth;
                const targetIdx = this.rNumbers.indexOf(winNum);
                const finalPos = (fullCycle * 3) + (targetIdx * slotWidth);
                
                wheel.style.transform = `translateX(-${finalPos}px)`;

                setTimeout(async () => {
                    let totalWin = 0;
                    this.rouletteBets.forEach(bet => {
                        let won = false;
                        if (bet.type === winNum.toString()) { totalWin += bet.amount * 36; won = true; }
                        else if (bet.type === 'red' && this.rReds.includes(winNum)) { totalWin += bet.amount * 2; won = true; }
                        else if (bet.type === 'black' && winNum !== 0 && !this.rReds.includes(winNum)) { totalWin += bet.amount * 2; won = true; }
                        else if (bet.type === 'even' && winNum !== 0 && winNum % 2 === 0) { totalWin += bet.amount * 2; won = true; }
                        else if (bet.type === 'odd' && winNum !== 0 && winNum % 2 !== 0) { totalWin += bet.amount * 2; won = true; }
                        else if (bet.type === '1-18' && winNum >= 1 && winNum <= 18) { totalWin += bet.amount * 2; won = true; }
                        else if (bet.type === '19-36' && winNum >= 19 && winNum <= 36) { totalWin += bet.amount * 2; won = true; }
                    });

                    if (totalWin > 0) {
                        this.playSound('win');
                        await this.updateBalance(totalWin);
                    } else {
                        this.playSound('loss');
                        await this.api(`users/${this.user}/balance`, 'PUT', this.balance);
                    }

                    this.logGame('ROULETTE', `Number ${winNum}`, totalWin, totalWin > 0 ? 'WIN' : 'LOSS');
                    
                    // Reset Wheel position instantly for next spin
                    wheel.style.transition = 'none';
                    wheel.style.transform = `translateX(-${targetIdx * slotWidth}px)`;
                    setTimeout(() => wheel.style.transition = 'transform 7s cubic-bezier(0.1, 0, 0.1, 1)', 50);
                    
                    this.isGaming = false;
                    this.rouletteBets = [];
                    this.drawChips();
                    spinBtn.disabled = false;
                }, 7500);
            },

            // --- COINFLIP LOGIC ---
            updateCFUI() {
                document.getElementById('cf-h').className = `btn ${this.cfSide === 'heads' ? 'btn-gold' : ''}`;
                document.getElementById('cf-t').className = `btn ${this.cfSide === 'tails' ? 'btn-gold' : ''}`;
            },

            async playCoinflip() {
                if (this.isGaming) return;
                const bet = parseInt(document.getElementById('cf-bet').value);
                if (isNaN(bet) || bet < 10 || bet > this.balance) return alert("Invalid bet amount");

                this.isGaming = true;
                await this.updateBalance(-bet);

                const coin = document.getElementById('coin-inner');
                const result = Math.random() < 0.5 ? 'heads' : 'tails';
                const flips = 10 + Math.floor(Math.random() * 5);
                const rotation = result === 'heads' ? flips * 360 : (flips * 360) + 180;

                coin.style.transform = `rotateY(${rotation}deg)`;

                setTimeout(async () => {
                    const win = result === this.cfSide;
                    if (win) {
                        this.playSound('win');
                        await this.updateBalance(bet * 2);
                    } else {
                        this.playSound('loss');
                    }
                    this.logGame('COINFLIP', result.toUpperCase(), win ? bet * 2 : 0, win ? 'WIN' : 'LOSS');
                    this.isGaming = false;
                }, 3100);
            },

            // --- DICE LOGIC ---
            async playDice(mode) {
                if (this.isGaming) return;
                const bet = parseInt(document.getElementById('dice-bet').value);
                const target = parseInt(document.getElementById('dice-target').value);
                
                if (isNaN(bet) || bet < 10 || bet > this.balance) return alert("Invalid bet");
                if (mode === 'target' && (isNaN(target) || target < 1 || target > 6)) return alert("Select target 1-6");

                this.isGaming = true;
                await this.updateBalance(-bet);
                
                const die = document.getElementById('die-val');
                let count = 0;
                const rollInt = setInterval(() => {
                    die.innerText = Math.floor(Math.random() * 6) + 1;
                    count++;
                    if (count > 20) {
                        clearInterval(rollInt);
                        const final = Math.floor(Math.random() * 6) + 1;
                        die.innerText = final;
                        this.finishDice(mode, final, bet, target);
                    }
                }, 50);
            },

            async finishDice(mode, res, bet, target) {
                let win = false;
                let mult = 2;

                if (mode === 'low' && res <= 3) win = true;
                if (mode === 'high' && res >= 4) win = true;
                if (mode === 'even' && res % 2 === 0) win = true;
                if (mode === 'odd' && res % 2 !== 0) win = true;
                if (mode === 'target' && res === target) { win = true; mult = 5.5; }

                if (win) {
                    this.playSound('win');
                    await this.updateBalance(Math.floor(bet * mult));
                } else {
                    this.playSound('loss');
                }
                this.logGame('DICE', `Rolled ${res}`, win ? Math.floor(bet * mult) : 0, win ? 'WIN' : 'LOSS');
                this.isGaming = false;
            },

            // --- BACCARAT LOGIC ---
            async playBaccarat(side) {
                if (this.isGaming) return;
                const bet = parseInt(document.getElementById('bac-bet').value);
                if (isNaN(bet) || bet < 10 || bet > this.balance) return alert("Invalid bet");

                this.isGaming = true;
                await this.updateBalance(-bet);

                const pCont = document.getElementById('bac-p-cards');
                const bCont = document.getElementById('bac-b-cards');
                pCont.innerHTML = ""; bCont.innerHTML = "";

                const cards = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
                const suits = ["♠", "♥", "♦", "♣"];
                
                const getCard = () => {
                    const v = Math.floor(Math.random() * 13);
                    const s = Math.floor(Math.random() * 4);
                    const points = v >= 9 ? 0 : v + 1;
                    return { name: cards[v], suit: suits[s], pts: points };
                };

                const draw = (container, card) => {
                    const c = document.createElement('div');
                    c.className = "casino-card";
                    if (card.suit === "♥" || card.suit === "♦") c.style.color = "var(--red)";
                    c.innerHTML = `<div>${card.name}</div><div style="align-self:center; font-size:40px;">${card.suit}</div><div style="align-self:flex-end; transform: rotate(180deg)">${card.name}</div>`;
                    container.appendChild(c);
                };

                const p1 = getCard(); const p2 = getCard();
                const b1 = getCard(); const b2 = getCard();

                setTimeout(() => draw(pCont, p1), 400);
                setTimeout(() => draw(bCont, b1), 800);
                setTimeout(() => draw(pCont, p2), 1200);
                setTimeout(() => {
                    draw(bCont, b2);
                    const pScore = (p1.pts + p2.pts) % 10;
                    const bScore = (b1.pts + b2.pts) % 10;
                    document.getElementById('bac-p-score').innerText = pScore;
                    document.getElementById('bac-b-score').innerText = bScore;

                    let winner = 'tie';
                    if (pScore > bScore) winner = 'player';
                    else if (bScore > pScore) winner = 'banker';

                    setTimeout(async () => {
                        let win = false;
                        let mult = 1;
                        if (side === winner) {
                            win = true;
                            mult = side === 'player' ? 2 : (side === 'banker' ? 1.95 : 9);
                        }

                        if (win) {
                            this.playSound('win');
                            await this.updateBalance(Math.floor(bet * mult));
                        } else {
                            this.playSound('loss');
                        }
                        this.logGame('BACCARAT', `Result: ${winner.toUpperCase()}`, win ? Math.floor(bet * mult) : 0, win ? 'WIN' : 'LOSS');
                        this.isGaming = false;
                    }, 1000);
                }, 1600);
            },

            // --- ADMIN ---
            showAdmin() {
                const pass = prompt("Enter developer code:");
                if (pass === "swarm2026") {
                    document.getElementById('admin-modal').classList.remove('hidden');
                }
            },

            async adminAddChips() {
                const amt = parseInt(document.getElementById('admin-chips').value);
                await this.updateBalance(amt);
                alert("Chips added via debug console.");
            }
        };

        // Initialize Application
        window.onload = () => app.init();

    </script>
</body>
</html>
