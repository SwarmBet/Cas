<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWARMBET | ELITE ONLINE CASINO 2026</title>
    <style>
        :root {
            --gold: #d4af37;
            --gold-bright: #f9e295;
            --dark-bg: #050505;
            --panel-bg: #121212;
            --green: #27ae60;
            --red: #c0392b;
            --blue: #2980b9;
            --text: #e0e0e0;
            --border: #222;
            --shadow: 0 8px 32px rgba(0,0,0,0.8);
        }

        * { box-sizing: border-box; outline: none; }
        body {
            background-color: var(--dark-bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            overflow-x: hidden;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
        }

        /* --- UI UTILITIES --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .center { align-items: center; justify-content: center; }
        .gold-text { color: var(--gold); text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
        .btn {
            background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { border-color: var(--gold); box-shadow: 0 0 15px var(--gold); transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-gold { background: linear-gradient(145deg, var(--gold), #8a6d3b); color: black; border: none; }

        /* --- NAVBAR --- */
        nav {
            background: rgba(0,0,0,0.95);
            border-bottom: 2px solid var(--gold);
            padding: 0 40px;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo { font-size: 28px; font-weight: 900; letter-spacing: 3px; cursor: pointer; }
        .logo span { color: var(--gold); }
        .nav-links { display: flex; gap: 30px; }
        .nav-links div { cursor: pointer; font-weight: 600; transition: 0.3s; color: #888; }
        .nav-links div:hover, .nav-links div.active { color: var(--gold); }
        .user-nav { display: flex; align-items: center; gap: 20px; }
        .balance-box { background: #1a1a1a; padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); font-weight: bold; }

        /* --- AUTH SCREEN --- */
        #auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 2000; display: flex; flex-direction: column;
        }
        .auth-card {
            background: var(--panel-bg); border: 1px solid var(--gold);
            padding: 40px; width: 400px; border-radius: 8px; box-shadow: var(--shadow);
            text-align: center;
        }
        .auth-card input {
            width: 100%; padding: 12px; margin: 10px 0;
            background: #000; border: 1px solid #333; color: white; border-radius: 4px;
        }

        /* --- LAYOUT --- */
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        .main-content { min-height: 80vh; }
        .sidebar { display: flex; flex-direction: column; gap: 20px; }

        /* --- PANELS --- */
        .panel { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 8px; padding: 20px; box-shadow: var(--shadow); }
        .panel-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; display: flex; justify-content: space-between; }

        /* --- GAME GRID --- */
        .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .game-card {
            height: 200px; border-radius: 12px; background: #1a1a1a; cursor: pointer;
            position: relative; overflow: hidden; border: 1px solid #333; transition: 0.4s;
            display: flex; flex-direction: column; justify-content: flex-end; padding: 20px;
        }
        .game-card:hover { transform: scale(1.03); border-color: var(--gold); }
        .game-card i { position: absolute; top: 20px; right: 20px; font-size: 40px; opacity: 0.2; }
        .game-card h3 { margin: 0; font-size: 24px; z-index: 2; }
        .game-card p { margin: 5px 0 0; color: #888; font-size: 14px; z-index: 2; }

        /* --- ROULETTE TABLE --- */
        .roulette-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .r-wheel-area { width: 100%; height: 120px; background: #000; border: 2px solid var(--gold); overflow: hidden; position: relative; border-radius: 8px; }
        .r-wheel-strip { display: flex; position: absolute; left: 50%; height: 100%; transition: transform 6s cubic-bezier(0.1, 0, 0.1, 1); }
        .r-slot { min-width: 80px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; border-right: 1px solid rgba(255,255,255,0.1); }
        .r-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: var(--gold); transform: translateX(-50%); z-index: 10; box-shadow: 0 0 15px var(--gold); }
        
        .r-table { display: grid; grid-template-columns: 60px repeat(12, 1fr); gap: 2px; background: #222; padding: 5px; border-radius: 4px; margin-top: 20px; user-select: none; }
        .r-cell { height: 60px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; font-weight: bold; font-size: 18px; transition: 0.2s; background: #1a1a1a; }
        .r-cell:hover { filter: brightness(1.5); }
        .r-zero { grid-row: span 3; background: var(--green); }
        .r-red { background: var(--red); }
        .r-black { background: var(--dark-bg); }
        .r-outside { background: #2c3e50; font-size: 14px; height: 50px; }
        .chip { 
            position: absolute; width: 30px; height: 30px; border-radius: 50%; background: var(--gold); 
            color: black; font-size: 10px; display: flex; align-items: center; justify-content: center; 
            border: 2px dashed #000; font-weight: 900; pointer-events: none; z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* --- COINFLIP --- */
        .coin-wrap { perspective: 1000px; width: 150px; height: 150px; margin: 30px auto; }
        .coin { 
            width: 100%; height: 100%; position: relative; transform-style: preserve-3d; 
            transition: transform 3s cubic-bezier(0.2, 0, 0.2, 1);
        }
        .coin-side { 
            position: absolute; width: 100%; height: 100%; border-radius: 50%; 
            backface-visibility: hidden; display: flex; align-items: center; 
            justify-content: center; font-size: 24px; font-weight: bold; border: 8px solid var(--gold);
        }
        .heads { background: #b8860b; color: white; }
        .tails { background: #555; color: white; transform: rotateY(180deg); }

        /* --- DICE --- */
        .dice-area { display: flex; gap: 20px; justify-content: center; margin: 30px 0; }
        .die { 
            width: 80px; height: 80px; background: white; border-radius: 12px; 
            color: black; display: flex; align-items: center; justify-content: center; 
            font-size: 40px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
        }

        /* --- BACCARAT --- */
        .b-area { display: flex; justify-content: space-around; margin-top: 20px; }
        .b-side { text-align: center; width: 45%; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .card-slot { display: flex; gap: 10px; justify-content: center; margin: 15px 0; height: 100px; }
        .playing-card { 
            width: 70px; height: 100px; background: white; border-radius: 5px; color: black; 
            display: flex; flex-direction: column; padding: 5px; font-weight: bold; position: relative;
        }

        /* --- CHAT --- */
        #chat-messages { height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; padding-right: 5px; }
        .msg { font-size: 13px; line-height: 1.4; padding: 5px 8px; background: rgba(255,255,255,0.03); border-radius: 4px; }
        .msg-user { color: var(--gold); font-weight: bold; margin-right: 5px; }
        .msg-time { color: #555; font-size: 10px; float: right; }

        /* --- LEADERBOARD --- */
        .lb-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #1a1a1a; font-size: 14px; }
        .lb-row.first { color: var(--gold); font-weight: bold; background: rgba(212, 175, 55, 0.05); }

        /* --- DAILY BONUS --- */
        .bonus-ready { animation: pulse-gold 2s infinite; }
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* --- FOOTER --- */
        footer { margin-top: 50px; padding: 40px; border-top: 1px solid #222; text-align: center; color: #555; font-size: 14px; }

        /* --- ANIMATIONS --- */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .page-anim { animation: slideIn 0.5s ease-out; }

        /* --- CUSTOM SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div style="flex: 1; display: flex; align-items: center; justify-content: center;">
            <div class="auth-card page-anim">
                <h1 class="gold-text" style="font-size: 36px; margin-bottom: 5px;">SWARMBET</h1>
                <p style="color: #666; margin-bottom: 30px;">THE FUTURE OF GAMBLING</p>
                <div id="auth-msg" style="color: var(--red); margin-bottom: 10px; font-size: 14px; min-height: 20px;"></div>
                <input type="text" id="auth-user" placeholder="Username" maxlength="15">
                <input type="password" id="auth-pass" placeholder="Password">
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-gold" style="flex: 1;" onclick="handleAuth('login')">LOGIN</button>
                    <button class="btn" style="flex: 1;" onclick="handleAuth('reg')">REGISTER</button>
                </div>
            </div>
        </div>
        <footer style="border: none;">© 2026 SWARMBET | PROVABLY FAIR | 18+ ONLY</footer>
    </div>

    <nav id="top-nav" class="hidden">
        <div class="logo" onclick="nav('home')">SWARM<span>BET</span></div>
        <div class="nav-links">
            <div id="nav-home" onclick="nav('home')" class="active">HOME</div>
            <div id="nav-games" onclick="nav('games')">GAMES</div>
            <div id="nav-discord" onclick="nav('discord')">DISCORD</div>
        </div>
        <div class="user-nav">
            <div class="balance-box">⭐ <span id="user-balance">0</span></div>
            <div id="user-name-display" class="gold-text" style="font-weight: 900; cursor: pointer;" onclick="toggleAdmin()">---</div>
            <button class="btn" onclick="logout()" style="padding: 5px 10px; font-size: 10px;">LOGOUT</button>
        </div>
    </nav>

    <div id="app-content" class="container hidden">
        
        <div class="main-content">
            
            <div id="page-home" class="page-anim">
                <div class="panel" style="background: linear-gradient(to right, #121212, #1a1a1a); margin-bottom: 20px; border-left: 4px solid var(--gold);">
                    <h1 style="margin: 0; font-size: 32px;">WELCOME BACK, <span id="welcome-name" class="gold-text">PLAYER</span>!</h1>
                    <p style="color: #888;">Feeling lucky today? Dive into our elite selection of games.</p>
                    <button id="btn-daily" class="btn btn-gold" style="margin-top: 10px;" onclick="claimDaily()">CLAIM DAILY BONUS</button>
                </div>

                <div class="panel">
                    <div class="panel-title">LIVE STATISTICS</div>
                    <div class="flex" style="gap: 40px; text-align: center;">
                        <div style="flex: 1;">
                            <div id="stat-wins" style="font-size: 24px; font-weight: bold; color: var(--green);">0</div>
                            <div style="font-size: 12px; color: #555;">TOTAL WINS</div>
                        </div>
                        <div style="flex: 1;">
                            <div id="stat-bets" style="font-size: 24px; font-weight: bold;">0</div>
                            <div style="font-size: 12px; color: #555;">BETS PLACED</div>
                        </div>
                        <div style="flex: 1;">
                            <div id="stat-online" style="font-size: 24px; font-weight: bold; color: var(--blue);">1</div>
                            <div style="font-size: 12px; color: #555;">ONLINE PLAYERS</div>
                        </div>
                    </div>
                </div>

                <h2 class="gold-text" style="margin-top: 40px; letter-spacing: 2px;">FEATURED GAMES</h2>
                <div class="games-grid">
                    <div class="game-card" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?auto=format&fit=crop&q=80&w=400') center;" onclick="nav('games', 'roulette')">
                        <h3>ROULETTE</h3>
                        <p>European Edition • Multiple Bets</p>
                    </div>
                    <div class="game-card" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1605870445919-838d190e8e1b?auto=format&fit=crop&q=80&w=400') center;" onclick="nav('games', 'coinflip')">
                        <h3>COIN FLIP</h3>
                        <p>Heads or Tails • 2.0x Payout</p>
                    </div>
                </div>
            </div>

            <div id="page-games" class="hidden page-anim">
                <div class="games-grid">
                    <div class="game-card" onclick="openGame('roulette')">
                        <i class="gold-text">R</i>
                        <h3>ROULETTE</h3>
                        <p>Classic European Wheel</p>
                    </div>
                    <div class="game-card" onclick="openGame('coinflip')">
                        <i class="gold-text">C</i>
                        <h3>COIN FLIP</h3>
                        <p>Simple 50/50 Chance</p>
                    </div>
                    <div class="game-card" onclick="openGame('dice')">
                        <i class="gold-text">D</i>
                        <h3>DICE</h3>
                        <p>Roll for victory</p>
                    </div>
                    <div class="game-card" onclick="openGame('baccarat')">
                        <i class="gold-text">B</i>
                        <h3>BACCARAT</h3>
                        <p>Elite Card Game</p>
                    </div>
                </div>
            </div>

            <div id="game-container" class="hidden">
                <div id="game-ui" class="panel page-anim">
                    </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <div class="panel-title">HISTORY</div>
                    <div id="history-list" style="max-height: 200px; overflow-y: auto;">
                        </div>
                </div>
            </div>

            <div id="page-discord" class="hidden page-anim">
                <div class="panel" style="text-align: center; padding: 100px 20px;">
                    <h1 class="gold-text" style="font-size: 48px;">JOIN THE ELITE</h1>
                    <p style="font-size: 18px; color: #888;">Our community is waiting for you.</p>
                    <button class="btn btn-gold" onclick="window.open('https://discord.com', '_blank')">JOIN DISCORD SERVER</button>
                </div>
            </div>

        </div>

        <div class="sidebar">
            <div class="panel">
                <div class="panel-title">GLOBAL CHAT</div>
                <div id="chat-messages"></div>
                <div style="display: flex; gap: 5px; margin-top: 10px;">
                    <input type="text" id="chat-input" placeholder="Message..." style="flex: 1; background: #000; border: 1px solid #333; color: white; padding: 8px; border-radius: 4px;">
                    <button class="btn" onclick="sendChat()" style="padding: 8px 12px;">SEND</button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">TOP PLAYERS</div>
                <div id="leaderboard-list"></div>
            </div>

            <div class="panel">
                <div class="panel-title">SETTINGS</div>
                <div style="display: flex; flex-direction: column; gap: 10px; font-size: 14px;">
                    <label class="flex center" style="justify-content: space-between;">
                        <span>Sound Effects</span>
                        <input type="checkbox" id="set-sound" checked onchange="saveSettings()">
                    </label>
                    <label class="flex center" style="justify-content: space-between;">
                        <span>Animations</span>
                        <input type="checkbox" id="set-anim" checked onchange="saveSettings()">
                    </label>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">ONLINE NOW</div>
                <div id="online-players-list" style="font-size: 12px; color: #777;"></div>
            </div>
        </div>

    </div>

    <div id="admin-panel" class="hidden" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3000; background: #222; border: 2px solid var(--gold); padding: 20px; width: 300px;">
        <h3>ADMIN DEBUG</h3>
        <input type="number" id="adm-amt" placeholder="Amount" style="width: 100%; margin-bottom: 10px;">
        <button class="btn btn-gold" onclick="adminAddChips()">ADD CHIPS</button>
        <button class="btn" onclick="toggleAdmin()" style="margin-top: 10px; width: 100%;">CLOSE</button>
    </div>

    <footer>
        <div style="color: var(--gold); font-weight: bold; margin-bottom: 10px;">SWARMBET CASINO 2026</div>
        <div>PROVABLY FAIR GAMING • ENCRYPTED TRANSACTIONS • INSTANT PAYOUTS</div>
        <div style="margin-top: 10px; font-size: 11px;">Gambling can be addictive. Please play responsibly.</div>
    </footer>

    <script>
        const DB_URL = "https://casbss-c75a0-default-rtdb.europe-west1.firebasedatabase.app/";
        
        // --- GLOBAL STATE ---
        let USER = null;
        let CHIPS = 0;
        let ACTIVE_PAGE = 'home';
        let ACTIVE_GAME = null;
        let SOUNDS_ON = true;
        let ANIMS_ON = true;
        let IS_ADMIN = false;
        let CHAT_COOLDOWN = false;
        let ROULETTE_BETS = [];
        let IS_GAMING = false;

        // --- CORE FUNCTIONS ---
        async function api(path, method = 'GET', body = null) {
            const options = { method };
            if (body) options.body = JSON.stringify(body);
            const res = await fetch(`${DB_URL}${path}.json`, options);
            return res.json();
        }

        function playSound(type) {
            if (!SOUNDS_ON) return;
            const sounds = {
                click: "https://www.soundjay.com/buttons/button-16.mp3",
                win: "https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3",
                loss: "https://www.soundjay.com/buttons/button-10.mp3",
                chip: "https://www.soundjay.com/buttons/button-50.mp3"
            };
            new Audio(sounds[type] || sounds.click).play().catch(()=>{});
        }

        // --- AUTH ---
        async function handleAuth(type) {
            const user = document.getElementById('auth-user').value.trim().toLowerCase();
            const pass = document.getElementById('auth-pass').value;
            const msg = document.getElementById('auth-msg');

            if (user.length < 3 || pass.length < 4) {
                msg.innerText = "Username min 3, Password min 4 chars.";
                return;
            }

            msg.innerText = "Connecting...";
            const data = await api(`users/${user}`);

            if (type === 'reg') {
                if (data) {
                    msg.innerText = "User already exists.";
                    return;
                }
                const newUser = {
                    username: user,
                    password: pass,
                    balance: 1000,
                    lastDaily: 0,
                    history: [],
                    joined: Date.now(),
                    online: true
                };
                await api(`users/${user}`, 'PUT', newUser);
                login(newUser);
            } else {
                if (!data || data.password !== pass) {
                    msg.innerText = "Invalid credentials.";
                    return;
                }
                login(data);
            }
        }

        function login(userData) {
            USER = userData.username;
            CHIPS = userData.balance;
            localStorage.setItem('swarm_user', USER);
            
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('top-nav').classList.remove('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            
            document.getElementById('user-name-display').innerText = USER.toUpperCase();
            document.getElementById('welcome-name').innerText = USER.toUpperCase();
            updateBalanceUI();
            
            // Listeners
            startSync();
            initChat();
            loadSettings();
            checkDailyStatus();
            nav('home');
        }

        function logout() {
            if (USER) api(`users/${USER}/online`, 'PUT', false);
            localStorage.removeItem('swarm_user');
            location.reload();
        }

        async function updateBalance(amount, game, detail, type) {
            if (CHIPS + amount < 0) return false;
            CHIPS += amount;
            updateBalanceUI();
            
            const log = {
                amount, game, detail, type, time: Date.now()
            };
            
            await api(`users/${USER}/balance`, 'PUT', CHIPS);
            await api(`history/${USER}/${Date.now()}`, 'PUT', log);
            return true;
        }

        function updateBalanceUI() {
            document.getElementById('user-balance').innerText = Math.floor(CHIPS).toLocaleString();
        }

        // --- SYNC & ONLINE ---
        function startSync() {
            setInterval(async () => {
                const users = await api('users');
                if (!users) return;

                // Leaderboard
                const sorted = Object.values(users).sort((a,b) => b.balance - a.balance).slice(0, 10);
                const lbList = document.getElementById('leaderboard-list');
                lbList.innerHTML = sorted.map((u, i) => `
                    <div class="lb-row ${i === 0 ? 'first' : ''}">
                        <span>#${i+1} ${u.username}</span>
                        <span>⭐ ${Math.floor(u.balance)}</span>
                    </div>
                `).join('');

                // Online count
                const online = Object.values(users).filter(u => u.online).length;
                document.getElementById('stat-online').innerText = online;
                document.getElementById('online-players-list').innerText = Object.values(users)
                    .filter(u => u.online)
                    .map(u => u.username)
                    .join(', ');

                // User balance check (anti-manipulation)
                if (users[USER]) {
                    if (Math.abs(CHIPS - users[USER].balance) > 1 && !IS_GAMING) {
                        CHIPS = users[USER].balance;
                        updateBalanceUI();
                    }
                }
            }, 5000);

            // Set online
            api(`users/${USER}/online`, 'PUT', true);
            window.onbeforeunload = () => { api(`users/${USER}/online`, 'PUT', false); };
        }

        // --- NAVIGATION ---
        function nav(page, sub = null) {
            if (IS_GAMING) return;
            ACTIVE_PAGE = page;
            
            document.getElementById('nav-home').classList.remove('active');
            document.getElementById('nav-games').classList.remove('active');
            document.getElementById('nav-discord').classList.remove('active');
            document.getElementById('nav-' + page).classList.add('active');

            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-games').classList.add('hidden');
            document.getElementById('page-discord').classList.add('hidden');
            document.getElementById('game-container').classList.add('hidden');

            document.getElementById('page-' + page).classList.remove('hidden');

            if (sub) openGame(sub);
        }

        // --- CHAT ---
        async function initChat() {
            const chatBox = document.getElementById('chat-messages');
            setInterval(async () => {
                const msgs = await api('chat');
                if (!msgs) return;
                const lastMsgs = Object.values(msgs).slice(-30);
                chatBox.innerHTML = lastMsgs.map(m => `
                    <div class="msg">
                        <span class="msg-time">${new Date(m.time).toLocaleTimeString()}</span>
                        <span class="msg-user">${m.user}:</span>
                        <span class="msg-text">${m.text}</span>
                    </div>
                `).join('');
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 3000);
        }

        async function sendChat() {
            if (CHAT_COOLDOWN) return;
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            CHAT_COOLDOWN = true;
            await api(`chat/${Date.now()}`, 'PUT', { user: USER, text, time: Date.now() });
            input.value = "";
            setTimeout(() => { CHAT_COOLDOWN = false; }, 2000);
        }

        // --- SETTINGS ---
        function loadSettings() {
            const s = JSON.parse(localStorage.getItem('swarm_settings') || '{"sound":true, "anim":true}');
            SOUNDS_ON = s.sound;
            ANIMS_ON = s.anim;
            document.getElementById('set-sound').checked = SOUNDS_ON;
            document.getElementById('set-anim').checked = ANIMS_ON;
        }

        function saveSettings() {
            SOUNDS_ON = document.getElementById('set-sound').checked;
            ANIMS_ON = document.getElementById('set-anim').checked;
            localStorage.setItem('swarm_settings', JSON.stringify({sound: SOUNDS_ON, anim: ANIMS_ON}));
        }

        // --- BONUS ---
        async function checkDailyStatus() {
            const data = await api(`users/${USER}/lastDaily`);
            const now = Date.now();
            const btn = document.getElementById('btn-daily');
            if (now - data > 86400000) {
                btn.classList.add('bonus-ready');
                btn.innerText = "CLAIM DAILY BONUS";
                btn.disabled = false;
            } else {
                btn.classList.remove('bonus-ready');
                const hoursLeft = Math.ceil((86400000 - (now - data)) / 3600000);
                btn.innerText = `NEXT BONUS IN ${hoursLeft}H`;
                btn.disabled = true;
            }
        }

        async function claimDaily() {
            const amount = Math.floor(Math.random() * 451) + 50;
            const success = await updateBalance(amount, 'BONUS', 'Daily Claim', 'WIN');
            if (success) {
                await api(`users/${USER}/lastDaily`, 'PUT', Date.now());
                alert(`You received ⭐ ${amount} chips!`);
                checkDailyStatus();
            }
        }

        // --- GAME ENGINE ---
        function openGame(game) {
            ACTIVE_GAME = game;
            document.getElementById('page-games').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            renderGameUI();
            loadGameHistory();
        }

        async function loadGameHistory() {
            const hist = await api(`history/${USER}`);
            const list = document.getElementById('history-list');
            if (!hist) { list.innerHTML = "No history yet."; return; }
            const entries = Object.values(hist).filter(h => h.game === ACTIVE_GAME.toUpperCase()).reverse().slice(0, 20);
            list.innerHTML = entries.map(h => `
                <div style="display: flex; justify-content: space-between; font-size: 12px; padding: 5px; border-bottom: 1px solid #222;">
                    <span style="color: ${h.amount >= 0 ? 'var(--green)' : 'var(--red)'}">${h.amount >= 0 ? '+' : ''}${h.amount}</span>
                    <span style="color: #666;">${h.detail}</span>
                    <span style="color: #444;">${new Date(h.time).toLocaleTimeString()}</span>
                </div>
            `).join('');
        }

        function renderGameUI() {
            const container = document.getElementById('game-ui');
            let html = "";

            if (ACTIVE_GAME === 'roulette') {
                html = `
                    <div class="roulette-container">
                        <div class="r-wheel-area">
                            <div class="r-marker"></div>
                            <div id="r-wheel" class="r-wheel-strip"></div>
                        </div>
                        <div class="r-table" id="r-table-main">
                            </div>
                        <div class="flex" style="gap: 5px; margin-top: 10px; flex-wrap: wrap; justify-content: center;">
                            <div class="r-cell r-outside" onclick="addRBet('red', 100)" style="background: var(--red); width: 100px;">RED (2x)</div>
                            <div class="r-cell r-outside" onclick="addRBet('black', 100)" style="background: #000; width: 100px;">BLACK (2x)</div>
                            <div class="r-cell r-outside" onclick="addRBet('even', 100)" style="width: 100px;">EVEN (2x)</div>
                            <div class="r-cell r-outside" onclick="addRBet('odd', 100)" style="width: 100px;">ODD (2x)</div>
                            <div class="r-cell r-outside" onclick="addRBet('1-18', 100)" style="width: 80px;">1-18</div>
                            <div class="r-cell r-outside" onclick="addRBet('19-36', 100)" style="width: 80px;">19-36</div>
                        </div>
                        <div class="flex center" style="gap: 20px; width: 100%;">
                            <div class="balance-box" style="font-size: 20px;">TOTAL BET: <span id="r-total-bet">0</span></div>
                            <button id="r-spin-btn" class="btn btn-gold" style="padding: 15px 40px;" onclick="spinRoulette()">SPIN WHEEL</button>
                            <button class="btn" onclick="clearRoulette()">CLEAR</button>
                        </div>
                    </div>
                `;
            } else if (ACTIVE_GAME === 'coinflip') {
                html = `
                    <div style="text-align: center;">
                        <h2 class="gold-text">COIN FLIP</h2>
                        <div class="coin-wrap">
                            <div id="coin" class="coin">
                                <div class="coin-side heads">HEADS</div>
                                <div class="coin-side tails">TAILS</div>
                            </div>
                        </div>
                        <div class="flex center" style="gap: 20px; margin-top: 40px;">
                            <button class="btn ${ACTIVE_GAME_SIDE === 'heads' ? 'btn-gold' : ''}" onclick="ACTIVE_GAME_SIDE='heads'; renderGameUI();">HEADS</button>
                            <button class="btn ${ACTIVE_GAME_SIDE === 'tails' ? 'btn-gold' : ''}" onclick="ACTIVE_GAME_SIDE='tails'; renderGameUI();">TAILS</button>
                        </div>
                        <div class="flex center" style="gap: 10px; margin-top: 20px;">
                            <input type="number" id="bet-amt" value="100" style="background: #000; border: 1px solid #333; color: white; padding: 10px; width: 120px; text-align: center;">
                            <button id="btn-play" class="btn btn-gold" onclick="playCoinflip()">FLIP COIN</button>
                        </div>
                    </div>
                `;
            } else if (ACTIVE_GAME === 'dice') {
                html = `
                    <div style="text-align: center;">
                        <h2 class="gold-text">DICE</h2>
                        <div class="dice-area">
                            <div id="die-1" class="die">1</div>
                        </div>
                        <div class="flex center" style="gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button class="btn" onclick="playDice('low')">LOW (1-3)</button>
                            <button class="btn" onclick="playDice('high')">HIGH (4-6)</button>
                            <button class="btn" onclick="playDice('even')">EVEN</button>
                            <button class="btn" onclick="playDice('odd')">ODD</button>
                            <input type="number" id="dice-num" placeholder="Num 1-6" style="width: 80px; padding: 8px; background: #000; color: white; border: 1px solid #333;">
                            <button class="btn btn-gold" onclick="playDice('num')">BET ON NUMBER</button>
                        </div>
                        <input type="number" id="bet-amt" value="100" style="background: #000; border: 1px solid #333; color: white; padding: 10px; width: 120px; text-align: center;">
                    </div>
                `;
            } else if (ACTIVE_GAME === 'baccarat') {
                html = `
                    <div style="text-align: center;">
                        <h2 class="gold-text">BACCARAT</h2>
                        <div class="b-area">
                            <div class="b-side">
                                <div style="color: var(--blue); font-weight: bold;">PLAYER</div>
                                <div id="b-player-score" style="font-size: 24px;">0</div>
                                <div id="b-player-cards" class="card-slot"></div>
                            </div>
                            <div class="b-side">
                                <div style="color: var(--red); font-weight: bold;">BANKER</div>
                                <div id="b-banker-score" style="font-size: 24px;">0</div>
                                <div id="b-banker-cards" class="card-slot"></div>
                            </div>
                        </div>
                        <div class="flex center" style="gap: 10px; margin-top: 30px;">
                            <button class="btn" style="border-color: var(--blue);" onclick="playBaccarat('player')">PLAYER (2x)</button>
                            <button class="btn" style="border-color: var(--gold);" onclick="playBaccarat('tie')">TIE (9x)</button>
                            <button class="btn" style="border-color: var(--red);" onclick="playBaccarat('banker')">BANKER (1.95x)</button>
                        </div>
                        <input type="number" id="bet-amt" value="100" style="margin-top: 15px; background: #000; border: 1px solid #333; color: white; padding: 10px; width: 120px; text-align: center;">
                    </div>
                `;
            }

            container.innerHTML = html;
            if (ACTIVE_GAME === 'roulette') initRouletteTable();
        }

        let ACTIVE_GAME_SIDE = 'heads';

        // --- ROULETTE LOGIC ---
        const R_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const R_REDS = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];

        function initRouletteTable() {
            const table = document.getElementById('r-table-main');
            table.innerHTML = "";
            
            // Zero
            const zero = document.createElement('div');
            zero.className = "r-cell r-zero";
            zero.innerText = "0";
            zero.onclick = () => addRBet('0', 100);
            table.appendChild(zero);

            // Numbers 1-36
            for (let i = 1; i <= 12; i++) {
                const col = document.createElement('div');
                col.style.display = "contents";
                for (let j = 1; j <= 3; j++) {
                    const n = (i - 1) * 3 + j;
                    const cell = document.createElement('div');
                    const color = R_REDS.includes(n) ? 'r-red' : 'r-black';
                    cell.className = `r-cell ${color}`;
                    cell.id = `r-cell-${n}`;
                    cell.innerText = n;
                    cell.onclick = () => addRBet(n.toString(), 100);
                    table.appendChild(cell);
                }
            }

            // Wheel strip
            const wheel = document.getElementById('r-wheel');
            let strip = "";
            for (let i = 0; i < 5; i++) {
                R_ORDER.forEach(n => {
                    const color = n === 0 ? 'var(--green)' : (R_REDS.includes(n) ? 'var(--red)' : '#111');
                    strip += `<div class="r-slot" style="background: ${color}">${n}</div>`;
                });
            }
            wheel.innerHTML = strip;
        }

        function addRBet(type, amount) {
            if (IS_GAMING) return;
            if (CHIPS < amount) return;
            
            playSound('chip');
            const existing = ROULETTE_BETS.find(b => b.type === type);
            if (existing) {
                existing.amount += amount;
            } else {
                ROULETTE_BETS.push({ type, amount });
            }
            
            CHIPS -= amount;
            updateBalanceUI();
            drawChips();
        }

        function drawChips() {
            // Clear old chips
            document.querySelectorAll('.chip').forEach(c => c.remove());
            let total = 0;
            ROULETTE_BETS.forEach(bet => {
                total += bet.amount;
                let parent;
                if (!isNaN(bet.type)) {
                    parent = document.getElementById(`r-cell-${bet.type}`);
                    if (bet.type === '0') parent = document.querySelector('.r-zero');
                }
                
                if (parent) {
                    const chip = document.createElement('div');
                    chip.className = "chip";
                    chip.innerText = bet.amount >= 1000 ? (bet.amount/1000).toFixed(1)+'k' : bet.amount;
                    parent.appendChild(chip);
                }
            });
            document.getElementById('r-total-bet').innerText = total;
        }

        function clearRoulette() {
            if (IS_GAMING) return;
            ROULETTE_BETS.forEach(b => CHIPS += b.amount);
            ROULETTE_BETS = [];
            updateBalanceUI();
            drawChips();
        }

        async function spinRoulette() {
            if (IS_GAMING || ROULETTE_BETS.length === 0) return;
            IS_GAMING = true;
            document.getElementById('r-spin-btn').disabled = true;

            const winNum = R_ORDER[Math.floor(Math.random() * R_ORDER.length)];
            const wheel = document.getElementById('r-wheel');
            
            // Animation logic
            const slotWidth = 80;
            const fullCircle = R_ORDER.length * slotWidth;
            const targetOffset = R_ORDER.indexOf(winNum) * slotWidth;
            const finalPos = (fullCircle * 3) + targetOffset;
            
            wheel.style.transform = `translateX(-${finalPos}px)`;

            setTimeout(async () => {
                let totalWin = 0;
                ROULETTE_BETS.forEach(bet => {
                    let won = false;
                    if (bet.type === winNum.toString()) { totalWin += bet.amount * 36; won = true; }
                    else if (bet.type === 'red' && R_REDS.includes(winNum)) { totalWin += bet.amount * 2; won = true; }
                    else if (bet.type === 'black' && winNum !== 0 && !R_REDS.includes(winNum)) { totalWin += bet.amount * 2; won = true; }
                    else if (bet.type === 'even' && winNum !== 0 && winNum % 2 === 0) { totalWin += bet.amount * 2; won = true; }
                    else if (bet.type === 'odd' && winNum !== 0 && winNum % 2 !== 0) { totalWin += bet.amount * 2; won = true; }
                    else if (bet.type === '1-18' && winNum >= 1 && winNum <= 18) { totalWin += bet.amount * 2; won = true; }
                    else if (bet.type === '19-36' && winNum >= 19 && winNum <= 36) { totalWin += bet.amount * 2; won = true; }
                });

                const totalBet = ROULETTE_BETS.reduce((a,b) => a + b.amount, 0);
                const net = totalWin - totalBet;

                await updateBalance(totalWin, 'ROULETTE', `Number ${winNum}`, totalWin > 0 ? 'WIN' : 'LOSS');
                
                if (totalWin > 0) playSound('win'); else playSound('loss');
                
                alert(`Result: ${winNum}. You ${totalWin > 0 ? 'won ' + totalWin : 'lost your bets'}.`);
                
                // Reset
                IS_GAMING = false;
                ROULETTE_BETS = [];
                wheel.style.transition = "none";
                wheel.style.transform = `translateX(-${targetOffset}px)`;
                setTimeout(() => wheel.style.transition = "transform 6s cubic-bezier(0.1, 0, 0.1, 1)", 50);
                
                document.getElementById('r-spin-btn').disabled = false;
                drawChips();
                loadGameHistory();
            }, 6500);
        }

        // --- COINFLIP LOGIC ---
        async function playCoinflip() {
            if (IS_GAMING) return;
            const bet = parseInt(document.getElementById('bet-amt').value);
            if (bet < 1 || bet > CHIPS) return alert("Invalid bet.");

            IS_GAMING = true;
            await updateBalance(-bet, 'COINFLIP', `Bet on ${ACTIVE_GAME_SIDE}`, 'BET');

            const coin = document.getElementById('coin');
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            const rotations = 10 + Math.floor(Math.random() * 10);
            const degree = result === 'heads' ? rotations * 360 : (rotations * 360) + 180;

            coin.style.transform = `rotateY(${degree}deg)`;

            setTimeout(async () => {
                if (result === ACTIVE_GAME_SIDE) {
                    await updateBalance(bet * 2, 'COINFLIP', 'Win x2', 'WIN');
                    playSound('win');
                } else {
                    playSound('loss');
                }
                IS_GAMING = false;
                loadGameHistory();
            }, 3100);
        }

        // --- DICE LOGIC ---
        async function playDice(type) {
            if (IS_GAMING) return;
            const bet = parseInt(document.getElementById('bet-amt').value);
            if (bet < 1 || bet > CHIPS) return alert("Invalid bet.");

            let winMult = 0;
            const targetNum = parseInt(document.getElementById('dice-num').value);

            if (type === 'num') {
                if (isNaN(targetNum) || targetNum < 1 || targetNum > 6) return alert("Select 1-6");
                winMult = 5;
            } else {
                winMult = 2;
            }

            IS_GAMING = true;
            await updateBalance(-bet, 'DICE', `Bet on ${type}`, 'BET');

            const die = document.getElementById('die-1');
            let counter = 0;
            const interval = setInterval(() => {
                die.innerText = Math.floor(Math.random() * 6) + 1;
                counter++;
                if (counter > 10) {
                    clearInterval(interval);
                    const res = Math.floor(Math.random() * 6) + 1;
                    die.innerText = res;
                    
                    let won = false;
                    if (type === 'low' && res <= 3) won = true;
                    if (type === 'high' && res >= 4) won = true;
                    if (type === 'even' && res % 2 === 0) won = true;
                    if (type === 'odd' && res % 2 !== 0) won = true;
                    if (type === 'num' && res === targetNum) won = true;

                    finishDice(won, bet, winMult, res);
                }
            }, 100);
        }

        async function finishDice(won, bet, mult, res) {
            if (won) {
                await updateBalance(bet * mult, 'DICE', `Result ${res}`, 'WIN');
                playSound('win');
            } else {
                playSound('loss');
            }
            IS_GAMING = false;
            loadGameHistory();
        }

        // --- BACCARAT LOGIC ---
        async function playBaccarat(betSide) {
            if (IS_GAMING) return;
            const bet = parseInt(document.getElementById('bet-amt').value);
            if (bet < 1 || bet > CHIPS) return alert("Invalid bet.");

            IS_GAMING = true;
            await updateBalance(-bet, 'BACCARAT', `Bet on ${betSide}`, 'BET');

            const pCards = document.getElementById('b-player-cards');
            const bCards = document.getElementById('b-banker-cards');
            pCards.innerHTML = ""; bCards.innerHTML = "";

            const getCard = () => {
                const val = Math.floor(Math.random() * 13) + 1;
                const suit = ['♠','♥','♦','♣'][Math.floor(Math.random()*4)];
                let score = val > 9 ? 0 : val;
                if (val === 1) score = 1;
                return { name: val === 1 ? 'A' : (val > 10 ? ['J','Q','K'][val-11] : val), suit, score };
            };

            const drawCard = (el, card) => {
                const c = document.createElement('div');
                c.className = "playing-card page-anim";
                c.style.color = (card.suit === '♥' || card.suit === '♦') ? 'red' : 'black';
                c.innerHTML = `<span>${card.name}</span><span style="font-size:30px; align-self:center;">${card.suit}</span>`;
                el.appendChild(c);
            };

            const p1 = getCard(); const p2 = getCard();
            const b1 = getCard(); const b2 = getCard();

            setTimeout(() => drawCard(pCards, p1), 200);
            setTimeout(() => drawCard(bCards, b1), 400);
            setTimeout(() => drawCard(pCards, p2), 600);
            setTimeout(() => {
                drawCard(bCards, b2);
                let pScore = (p1.score + p2.score) % 10;
                let bScore = (b1.score + b2.score) % 10;
                
                document.getElementById('b-player-score').innerText = pScore;
                document.getElementById('b-banker-score').innerText = bScore;

                let winner = pScore > bScore ? 'player' : (bScore > pScore ? 'banker' : 'tie');
                
                let winMult = 0;
                if (winner === betSide) {
                    if (winner === 'player') winMult = 2;
                    if (winner === 'banker') winMult = 1.95;
                    if (winner === 'tie') winMult = 9;
                }

                setTimeout(async () => {
                    if (winMult > 0) {
                        await updateBalance(bet * winMult, 'BACCARAT', `Winner: ${winner}`, 'WIN');
                        playSound('win');
                    } else {
                        playSound('loss');
                    }
                    IS_GAMING = false;
                    loadGameHistory();
                }, 1000);
            }, 800);
        }

        // --- ADMIN PANEL ---
        function toggleAdmin() {
            if (!IS_ADMIN && USER !== 'admin') {
                // Secret prompt
                const code = prompt("Enter Admin Code:");
                if (code === "swarm2026") {
                    IS_ADMIN = true;
                } else return;
            }
            document.getElementById('admin-panel').classList.toggle('hidden');
        }

        async function adminAddChips() {
            const amt = parseInt(document.getElementById('adm-amt').value);
            await updateBalance(amt, 'ADMIN', 'Manual Deposit', 'WIN');
            alert("Added " + amt);
        }

        // --- BOOTSTRAP ---
        window.onload = async () => {
            const savedUser = localStorage.getItem('swarm_user');
            if (savedUser) {
                const data = await api(`users/${savedUser}`);
                if (data) login(data);
                else localStorage.removeItem('swarm_user');
            }
        };

    </script>
</body>
</html>
