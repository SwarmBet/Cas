<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Golden Stake - ONLINE EDITION</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; margin: 0; }
        .game-container { width: 450px; background: #1a1a1a; border: 4px solid #d4af37; border-radius: 20px; padding: 20px; margin-top: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        #auth-box { text-align: center; padding: 20px; }
        input { background: #000; color: #ffd700; border: 1px solid #d4af37; padding: 10px; margin: 5px; border-radius: 5px; width: 85%; }
        .btn-gold { background: #d4af37; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; color: black; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .balance { font-size: 24px; color: #ffd700; font-weight: bold; }
        .hidden { display: none !important; }
        #admin-panel { margin-top: 20px; padding: 10px; border: 2px dashed #00ff00; background: rgba(0, 255, 0, 0.05); border-radius: 10px; }
        #admin-input { width: 90%; border: none; outline: none; background: #000; color: #0f0; padding: 8px; font-family: monospace; }
        .card-area { display: flex; justify-content: center; gap: 8px; min-height: 100px; margin: 10px 0; }
        .card { width: 60px; height: 90px; background: white; color: black; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
        .status { text-align: center; color: #ffd700; margin: 10px 0; font-weight: bold; min-height: 24px; }
    </style>
</head>
<body>

<div class="game-container">
    <div id="auth-box">
        <h2 style="color: #d4af37;">GOLDEN STAKE ONLINE</h2>
        <div id="auth-msg" style="margin-bottom:10px; color: #aaa;">Naƒç√≠t√°n√≠ datab√°ze...</div>
        <div id="auth-inputs">
            <input type="text" id="username" placeholder="U≈æivatelsk√© jm√©no">
            <input type="password" id="password" placeholder="Heslo">
            <br><br>
            <button class="btn-gold" onclick="handleAuth('login')">P≈òIHL√ÅSIT</button>
            <button class="btn-gold" style="background:#444; color:white;" onclick="handleAuth('register')">REGISTROVAT</button>
        </div>
    </div>

    <div id="game-box" class="hidden">
        <div class="header">
            <div id="user-display" style="color:#aaa; font-weight:bold;"></div>
            <div class="balance">üí∞ <span id="chips-val">0</span></div>
            <button onclick="logout()" style="background:none; border:none; color:#ff4444; cursor:pointer; font-weight:bold;">Odhl√°sit</button>
        </div>

        <div class="status" id="msg">V√≠tej v online kasinu!</div>

        <div id="bj-ui">
            <div id="bj-setup" style="text-align:center">
                S√°zka: <input type="number" id="bj-bet" value="10" style="width:70px;">
                <button class="btn-gold" id="bj-start" onclick="bjStart()">HR√ÅT</button>
            </div>
            <div id="cards-ui" class="hidden">
                <div style="text-align:center;">
                    <p>Dealer: <span id="d-val">?</span></p>
                    <div class="card-area" id="d-cards"></div>
                    <p>Ty: <span id="p-val">0</span></p>
                    <div class="card-area" id="p-cards"></div>
                </div>
                <div id="bj-actions" class="hidden" style="text-align:center; margin-top:15px;">
                    <button class="btn-gold" onclick="bjPlay('hit')">HIT</button>
                    <button class="btn-gold" style="background:#eee" onclick="bjPlay('stand')">STAND</button>
                </div>
            </div>
        </div>

        <div id="admin-panel" class="hidden">
            <div style="color:#0f0; font-size:12px; margin-bottom:5px; font-weight:bold;">üöΩ ADMIN PANEL (skibiditoilet)</div>
            <input type="text" id="admin-input" placeholder="/give jm√©no ƒç√°stka" onkeypress="checkAdminCommand(event)">
        </div>
    </div>
</div>

<script>
    // --- KONFIGURACE ONLINE DATAB√ÅZE ---
    const DB_URL = "https://casbss-c75a0-default-rtdb.europe-west1.firebasedatabase.app/users";
    const ADMIN_NAME = "skibiditoilet";
    let currentUser = null;

    // Funkce pro komunikaci s internetem
    async function loadAllUsers() {
        const r = await fetch(DB_URL + ".json");
        return await r.json() || {};
    }

    async function saveToServer(username, data) {
        await fetch(`${DB_URL}/${username}.json`, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }

    // --- AUTH SYST√âM ---
    async function handleAuth(type) {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value;
        if(!u || !p) return alert("Vypl≈à √∫daje!");

        document.getElementById('auth-msg').innerText = "Pracuji...";
        const users = await loadAllUsers();

        if(type === 'register') {
            if(users[u]) {
                document.getElementById('auth-msg').innerText = "Chyba: Jm√©no u≈æ existuje!";
                return alert("Tento u≈æivatel u≈æ existuje na jin√©m poƒç√≠taƒçi!");
            }
            const newUser = { password: p, chips: 100 }; // Bonus 100 do zaƒç√°tku
            await saveToServer(u, newUser);
            alert("Registrace √∫spƒõ≈°n√°! Nyn√≠ se p≈ôihlas.");
            document.getElementById('auth-msg').innerText = "Registrace hotova.";
        } else {
            if(users[u] && users[u].password === p) {
                currentUser = u;
                loginSuccess(users[u].chips);
            } else {
                alert("≈†patn√© jm√©no nebo heslo!");
                document.getElementById('auth-msg').innerText = "Zkus to znovu.";
            }
        }
    }

    function loginSuccess(chips) {
        document.getElementById('auth-box').classList.add('hidden');
        document.getElementById('game-box').classList.remove('hidden');
        document.getElementById('user-display').innerText = currentUser;
        document.getElementById('chips-val').innerText = chips;
        if(currentUser === ADMIN_NAME) document.getElementById('admin-panel').classList.remove('hidden');
    }

    function logout() { location.reload(); }

    // --- ADMIN KONZOLE ---
    async function checkAdminCommand(e) {
        if(e.key === 'Enter') {
            const val = document.getElementById('admin-input').value;
            const parts = val.split(' ');
            if(parts[0] === '/give' && parts.length === 3) {
                const target = parts[1];
                const amount = parseInt(parts[2]);
                const users = await loadAllUsers();
                if(users[target]) {
                    users[target].chips += amount;
                    await saveToServer(target, users[target]);
                    alert(`Odesl√°no ${amount} ≈æeton≈Ø pro ${target}`);
                    if(target === currentUser) document.getElementById('chips-val').innerText = users[target].chips;
                } else alert("Hr√°ƒç nebyl nalezen!");
            }
            document.getElementById('admin-input').value = '';
        }
    }

    // --- BLACKJACK LOGIKA ---
    let playing = false, curBet = 0, pHand = [], dHand = [], deck = [];

    async function bjStart() {
        const users = await loadAllUsers();
        curBet = parseInt(document.getElementById('bj-bet').value);
        if(curBet > users[currentUser].chips || curBet <= 0) return alert("M√°≈° m√°lo ≈æeton≈Ø!");

        users[currentUser].chips -= curBet;
        await saveToServer(currentUser, users[currentUser]);
        document.getElementById('chips-val').innerText = users[currentUser].chips;

        playing = true;
        document.getElementById('bj-start').disabled = true;
        document.getElementById('cards-ui').classList.remove('hidden');
        document.getElementById('bj-actions').classList.remove('hidden');
        
        deck = []; 
        ['‚ô†','‚ô•','‚ô¶','‚ô£'].forEach(s => ['2','3','4','5','6','7','8','9','10','J','Q','K','A'].forEach(v => deck.push({v,s})));
        deck.sort(() => Math.random() - 0.5);

        pHand = [deck.pop(), deck.pop()]; dHand = [deck.pop(), deck.pop()];
        renderBJ(false);
        if(getVal(pHand) === 21) bjEnd(true, "BLACKJACK!");
    }

    function renderBJ(all) {
        const p = document.getElementById('p-cards'), d = document.getElementById('d-cards');
        p.innerHTML = ''; d.innerHTML = '';
        pHand.forEach(c => p.innerHTML += `<div class="card">${c.v}${c.s}</div>`);
        dHand.forEach((c, i) => d.innerHTML += `<div class="card" style="${!all && i===1 ? 'background:#333':''}">${!all && i===1 ? '':c.v+c.s}</div>`);
        document.getElementById('p-val').innerText = getVal(pHand);
        document.getElementById('d-val').innerText = all ? getVal(dHand) : "?";
    }

    function getVal(h) {
        let s = 0, a = 0;
        h.forEach(c => { if(['J','Q','K'].includes(c.v)) s += 10; else if(c.v === 'A') { s += 11; a++; } else s += parseInt(c.v); });
        while(s > 21 && a > 0) { s -= 10; a--; }
        return s;
    }

    async function bjPlay(a) {
        if(!playing) return;
        if(a === 'hit') {
            pHand.push(deck.pop()); renderBJ(false);
            if(getVal(pHand) > 21) bjEnd(false, "BUST!");
        } else {
            document.getElementById('bj-actions').classList.add('hidden');
            renderBJ(true);
            while(getVal(dHand) < 17) {
                await new Promise(r => setTimeout(r, 600));
                dHand.push(deck.pop()); renderBJ(true);
            }
            let ps = getVal(pHand), ds = getVal(dHand);
            if(ds > 21 || ps > ds) bjEnd(true, "V√ùHRA!");
            else if(ps < ds) bjEnd(false, "PROHRA");
            else bjEnd('draw', "REMIZA");
        }
    }

    async function bjEnd(res, m) {
        playing = false;
        document.getElementById('bj-actions').classList.add('hidden');
        document.getElementById('bj-start').disabled = false;
        const users = await loadAllUsers();
        if(res === true) users[currentUser].chips += curBet * 2;
        if(res === 'draw') users[currentUser].chips += curBet;
        await saveToServer(currentUser, users[currentUser]);
        document.getElementById('chips-val').innerText = users[currentUser].chips;
        document.getElementById('msg').innerText = m;
    }
    
    document.getElementById('auth-msg').innerText = "Online.";
</script>
</body>
</html>
